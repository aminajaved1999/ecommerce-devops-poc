{% extends "store/base.html" %}
{% load static %}

{% block content %}

    <header class="p-5 hero-panel mx-auto mb-5 text-center" style="max-width: 800px; padding: 3rem 5rem !important;">
        <h1 class="display-4 fw-bolder text-dark mb-3">Find Your Style.<br>Secure Your Purchase.</h1>
        <p class="lead text-muted mb-4">
            Explore our curated collection of premium goods. We focus on durability, quality, and fast, reliable delivery.
        </p>
        <a href="#products-list" class="btn btn-hero shadow-sm fw-bold">SHOP THE COLLECTION</a>
    </header>

    <section id="products-list">
        <h2 class="text-center featured-header mb-5">Featured Collection</h2>

        <div class="row row-cols-1 row-cols-md-3 g-4 justify-content-center">
            {% if products %}
                {% for product in products %}
                    <div class="col">
                        <div class="card h-100 shadow-sm bg-white">
                            
                            <div style="height: 280px; overflow: hidden; background-color: var(--color-light-yellow);" class="rounded-top-4 p-3 d-flex align-items-center justify-content-center">
                                <a href="{% url 'product_detail' product.pk %}" style="display: block; width: 100%; height: 100%;">
                                    {% if "Shirt" in product.name %}
                                        <img src="{% static 'img/shirt.jpg' %}"
                                             class="img-fluid" alt="{{ product.name }}" style="width: 100%; height: 100%; object-fit: contain;">
                                    {% elif "Wallet" in product.name %}
                                        <img src="{% static 'img/wallet.jpg' %}"
                                             class="img-fluid" alt="{{ product.name }}" style="width: 100%; height: 100%; object-fit: cover;">
                                    {% elif "Shoes" in product.name %}
                                        <img src="{% static 'img/shoes.jpg' %}"
                                             class="img-fluid" alt="{{ product.name }}" style="width: 100%; height: 100%; object-fit: contain;">
                                    {% else %}
                                        <img src="{% static 'img/default.jpg' %}"
                                             class="img-fluid" alt="{{ product.name }}" style="width: 100%; height: 100%; object-fit: cover;">
                                    {% endif %}
                                </a>
                            </div>

                            <div class="card-body d-flex flex-column pt-3 text-center">
                                {# NEW: Display Category #}
                                {% if product.category %}
                                    <p class="small text-muted mb-1">{{ product.category.name }}</p>
                                {% endif %}
                                
                                <h3 class="h5 fw-bold text-dark">{{ product.name }}</h3>
                                <p class="card-text text-muted mb-2 small">{{ product.description|truncatewords:10 }}</p>

                                <div class="d-flex justify-content-between align-items-center mt-auto pt-3 border-top mx-auto w-75">
                                    <h4 class="fw-bolder mb-0 price-text">
                                        Â£{{ product.price }}
                                    </h4>
                                    
                                    {# Direct Add to Cart Form #}
                                    <div class="d-flex gap-2">
                                        <a href="{% url 'product_detail' product.pk %}" class="btn btn-outline-secondary btn-sm shadow-sm fw-bold">
                                            Details 
                                        </a>
                                        <form action="{% url 'add_to_cart' product.pk %}" method="POST" style="display: inline;">
                                            {% csrf_token %}
                                            {# Hidden input to send quantity=1 for quick add #}
                                            <input type="hidden" name="quantity" value="1"> 
                                            {# Direct users back to the product list page after quick adding #}
                                            <input type="hidden" name="next" value="{% url 'product_list' %}"> 
                                            <button type="submit" 
                                                    class="btn btn-primary btn-sm shadow-sm fw-bold"
                                                    {% if product.inventory_stock <= 0 %}disabled{% endif %}>
                                                <i class="bi bi-cart-plus"></i>
                                            </button>
                                        </form>
                                    </div>
                                    {# End Direct Add to Cart Form #}
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <div class="col-12">
                    <div class="alert alert-info">
                        No products found. Please ensure data migrations have run successfully.
                    </div>
                </div>
            {% endif %}
        </div>
    </section>

    <script>
        document.querySelectorAll('.card').forEach(card => {
            card.addEventListener('mouseenter', () => {
                const img = card.querySelector('img');
                if (img) img.style.transform = 'scale(1.08)';
            });
            card.addEventListener('mouseleave', () => {
                const img = card.querySelector('img');
                if (img) img.style.transform = 'scale(1.0)';
            });
        });
    </script>

{% endblock %}